name: E2E tests
on:
  workflow_dispatch:
  pull_request:
jobs:
  init:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version-file: 'go.mod'
      - name: Display Go version
        run: go version
      - name: Write KUBECONFIG to file
        run: |
          printf '%s' "${{ secrets.GARDENER }}" > kubeconfig-garden.yaml
      - name: Write e2e config file
        env:
          OIDC_CLIENT_ID: ${{ vars.OIDC_CLIENT_ID }}
          OIDC_ISSUER_URL: ${{ vars.OIDC_ISSUER_URL }}
        run: |
          cat << EOF > e2e-config.yaml
          gardenKubeconfig: kubeconfig-garden.yaml
          shootPrefix: pp
          kcpNamespace: kcp-system
          gardenNamespace: garden-spm-test01
          skrNamespace: default
          subscriptions:
            - name: spm-aws-subscription
              provider: aws
              isDefault: true
          networkOwner: gardener
          oidcClientId: $OIDC_CLIENT_ID
          oidcIssuerUrl: $OIDC_ISSUER_URL
          administrators:
              - vladimir.andjelkoski@sap.com
              - dl_623b719a6a0d2d029907bee0@global.corp.sap
          EOF
      - name: Display e2e config file
        run: cat e2e-config.yaml